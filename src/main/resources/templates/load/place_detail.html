<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<html layout:decorate="~{layout}">

<head>
	<title>ìƒí’ˆ ìƒì„¸í˜ì´ì§€</title>
	<!-- Bootstrap CSS -->
	<link href="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">

	<!-- Bootstrap JS (í•„ìš”í•œ ê²½ìš° Popper.js í¬í•¨) -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</head>
<div layout:fragment="content" class="container">
	<!--shop style link-->
	<link rel="stylesheet" th:href="@{/css/place_detail.css}">
	<!--í˜ì´ì§€ ì œëª©-->
	<div class="row my-5">
		<div class="pageTitle col text-center">
			ê°€ê²Œ ìƒì„¸í˜ì´ì§€
		</div>
	</div>

	<!--todo: ì œí’ˆ ê³µìœ  ë²„íŠ¼ ë§Œë“¤ë©´ ì¢‹ì„ë“¯.....-->

	<!-- ê°€ê²Œ ì •ë³´ ìš”ì•½ & ì£¼ë¬¸ í¼ -->
	<section class="placeInfo row my-4 py-4 rounded-2">
		<div class="placeImg col-6">
			<!-- ìƒí’ˆì´ë¯¸ì§€ -->
			<div class="card-img-wrapper rounded-2 mb-3">
				<div class="card-img-box" th:style="|background-image: url(@{  ${store.stoImage}  });|"></div>
			</div>
		</div> <!--placeImg-->
		<div class="col-6 card">
			<!-- ìƒí’ˆì •ë³´ -->
			<div class="card-body">
				<h5 class="placeName card-title" th:text="${store.stoName}"></h5>
				<p class="placeDesc card-text" th:text="${store.stoContent}"></p>
				<p class="card-text"><strong>ì œëª©:</strong> <span th:text="${store.stoTitle}"></span></p>
				<p class="card-text"><strong>ì¹´í…Œê³ ë¦¬:</strong> <span th:text="${store.stoCategory}"></span></p>
				<p class="card-text"><strong>ì¡°íšŒìˆ˜:</strong> <span th:text="${store.viewCount}"></span></p>
				<p class="card-text"><strong>ì¶”ì²œìˆ˜:</strong> <span th:text="${store.recommendationCount}"></span></p>
				<p class="card-text"><strong>ì§€ì—­:</strong> <span
						th:text="${store.stoRegionProvince} + ' ' + ${store.stoRegionCity}"></span></p>
				<p class="card-text"><strong>ì—°ë½ì²˜:</strong> <span th:text="${store.stoContact}"></span></p>
				<p class="card-text"><strong>ì£¼ì†Œ:</strong> <span th:text="${store.stoAddress}"></span></p>
				<p class="card-text"><strong>ìš´ì˜ ì‹œê°„:</strong> <span th:text="${store.stoOperatingHours}"></span></p>
				<p class="card-text"><strong>íœ´ë¬´ì¼:</strong> <span th:text="${store.stoClosedDays}"></span></p>
				<p class="card-text"><strong>ì¶”ì²œ ë©”ë‰´:</strong> <span th:text="${store.stoRecommendedMenu}"></span></p>
				<p class="card-text"><strong>ì£¼ì°¨ ì •ë³´:</strong> <span th:text="${store.stoParkingInfo}"></span></p>
				<p class="card-text"><strong>ì±„ì‹ì¢…ë¥˜:</strong> <span th:text="${store.stoVegetarianType}"></span></p>
				<p class="card-text"><strong>ì˜ì—… ì—¬ë¶€:</strong> <span th:text="${store.isOpen} ? 'ì˜ì—… ì¤‘' : 'ì˜ì—… ì¢…ë£Œ'"></span>
				</p>
				<span class="favorite-btn btn btn-warning" th:data-userid="${session.UserId}"
					th:data-storeid="${store.stoId}">ì°œğŸ‘</span>

			</div> <!-- //card-body -->
		</div> <!--col-6 card-->
	</section> <!--placeInfo-->

	<!-- ìƒì ë³„ ë¦¬ë·° -->
	<section class="storeReview my-5 p-3">
		<h3 class="text-center my-3">ìƒì  í›„ê¸°</h3>

		<!-- ì´ë¯¸ì§€ ë³´ê¸° -->
		<div th:if="${filteredReviewsCount <= 8}">
			<div class="revImgWrapper">
				<div class="revImgContainer ">
					<div class="carousel-inner justify-content-start">
						<th:block th:each="review, iterStat : ${filteredReviews}">
							<div class="carousel-item "
								th:class="'carousel-item ' + (${iterStat.index < 8} ? 'active' : '')">
								<a href="#" class="revImgLink d-block">
									<div class="revImgBox" th:style="'background-image: url(' + ${review.revImg} + ');'"
										th:data-img-url="${review.revImg}" th:data-sto-name="${store.stoName}"
										th:data-rev-text="${review.revText}" th:data-rev-rating="${review.revRating}"
										th:data-created-at="${#temporals.format(review.createdAt, 'yyyy.MM.dd')}"
										onclick="openModal(this)"></div>
								</a>
							</div>
						</th:block>
					</div> <!-- carousel-inner -->
				</div> <!-- revImgContainer -->
			</div> <!-- revImgWrapper -->
		</div>
		<div id="reviewCarousel" class="carousel slide" th:if="${filteredReviewsCount > 8}">
			<div class="revImgWrapper">
				<div class="revImgContainer">
					<div class="carousel-inner">
						<th:block th:each="review, iterStat : ${filteredReviews}">
							<div class="carousel-item "
								th:class="'carousel-item ' + (${iterStat.index < 8} ? 'active' : '')">
								<span class="revImgLink d-block">
									<div class="revImgBox" th:style="'background-image: url(' + ${review.revImg} + ');'"
										th:data-img-url="${review.revImg}" th:data-sto-name="${store.stoName}"
										th:data-rev-text="${review.revText}" th:data-rev-rating="${review.revRating}"
										th:data-created-at="${#temporals.format(review.createdAt, 'yyyy.MM.dd')}"
										onclick="openModal(this)"></div>
								</span>
							</div>
						</th:block>
					</div> <!-- carousel-inner -->
					<a class="carousel-control-prev">
						<span class="carousel-control-prev-icon" aria-hidden="true"></span>
						<span class="visually-hidden">ì´ì „</span>
					</a>
					<a class="carousel-control-next">
						<span class="carousel-control-next-icon" aria-hidden="true"></span>
						<span class="visually-hidden">ë‹¤ìŒ</span>
					</a>
				</div> <!-- revImgContainer -->
			</div> <!-- revImgWrapper -->
		</div> <!-- reviewCarousel -->

		<!-- ë¦¬ë·° ë³´ê¸° ë¸”ë¡ -->
		<div id="reviews my-3">
			<div class="row border-bottom">
				<span class="my-2">ì´
					<span th:text="${store.storeReviews.size()}"></span>
					ê°œ
				</span>
			</div>
			<div class="row border-bottom border-success reviewBlock py-2 my-3"
				th:each="review : ${store.storeReviews}">

				<div class="col-md-2 writer">[[${review.writer}]]</div>
				<div class="col-md-10">
					<div class="row revText justify-content-start mb-3 revStoName">
						<div class="col">[[${store.stoName}]]</div>
					</div>

					<div class="row revText justify-content-start my-3">
						<div class="col">[[${review.revText}]]</div>
					</div>
					<div class="row revImgRow justify-content-start">
						<div class="col">
							<div class="revImgBox" th:if="${review.revImg != null}"
								th:style="'background-image: url(' + ${review.revImg} + ');'"
								th:data-img-url="${review.revImg}" th:data-sto-name="${store.stoName}"
								th:data-rev-text="${review.revText}" th:data-rev-rating="${review.revRating}"
								th:data-created-at="${#temporals.format(review.createdAt, 'yyyy.MM.dd')}"
								onclick="openModal(this)">
							</div>
							<div class="col" id="ratingContainer" th:if="${review.revRating == 1}">ë³„ì : â˜…â˜†â˜†â˜†â˜†</div>
							<div class="col" id="ratingContainer" th:if="${review.revRating == 2}">ë³„ì : â˜…â˜…â˜†â˜†â˜†</div>
							<div class="col" id="ratingContainer" th:if="${review.revRating == 3}">ë³„ì : â˜…â˜…â˜…â˜†â˜†</div>
							<div class="col" id="ratingContainer" th:if="${review.revRating == 4}">ë³„ì : â˜…â˜…â˜…â˜…â˜†</div>
							<div class="col" id="ratingContainer" th:if="${review.revRating == 5}">ë³„ì : â˜…â˜…â˜…â˜…â˜…</div>
						</div>
					</div>
					<div class="row createdAt justify-content-start my-3">
						<div class="col">
							<small th:text="${#temporals.format(review.createdAt, 'yyyy.MM.dd.hh.mm.ss')}"></small>
						</div>
					</div>
					<button class="delete-review btn btn-danger" th:data-rev-id="${review.revId}">ì‚­ì œ</button>

				</div>
			</div>
			<button id="loadMoreButton" class="btn btn-primary my-3" style="display: none;">ë¦¬ë·° ë”ë³´ê¸°</button>
		</div>
		<!-- ëª¨ë‹¬ êµ¬ì¡° -->
		<div id="imageModal" class="modal" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">ì‚¬ì§„ í›„ê¸°</h5>
					</div>
					<div class="modal-body">
						<div class="row">
							<div class="col-7 ">
								<img id="modalImage" src="" alt="ë¦¬ë·° ì´ë¯¸ì§€" class="img-fluid">
							</div>
							<div class="col-5">
								<p>ê°€ê²Œëª… : <span id="modalStoName"></span></p>
								<p>ë‚´ìš© : <span id="modalRevText"></span></p>
								<p id="modalRevRating"></p>
								<p>ì‘ì„±ì¼ : <small id="modalCreatedAt"></small></p>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" onclick="closeModal()">ë‹«ê¸°</button>
					</div>
				</div>
			</div>
		</div>
		<!-- ë¦¬ë·° ì¶”ê°€ í¼ -->
		<form id="reviewForm" enctype="multipart/form-data" class="p-4">
			<h3 class="my-3">í›„ê¸° ì‘ì„±</h3>
			<h5>ì¥ì†Œ ë§Œì¡±ë„</h5>
			<div id="starRating">
				<span class="star" data-value="1">â˜…</span>
				<span class="star" data-value="2">â˜…</span>
				<span class="star" data-value="3">â˜…</span>
				<span class="star" data-value="4">â˜…</span>
				<span class="star" data-value="5">â˜…</span>
			</div>
			<h5 class="my-2">ì¥ì†Œ í›„ê¸°</h5>
			<textarea id="revText" placeholder="ìƒì  í›„ê¸°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”" required class="my-2 p-4 row"></textarea>
			<input type="hidden" id="revRating" required />
			<div class="row my-4">
				<h5>ì‚¬ì§„ ì˜¬ë¦¬ê¸°</h5>
				<input type="file" id="revImg" accept="image/*" />
			</div>
			<button type="submit" class="btn btn-info">ë¦¬ë·° ì¶”ê°€</button>
		</form>


	</section>
	<button th:if="${session.UserId == 'admin'}" th:id="'delete-' + ${store.stoId}"
		th:onclick="'deleteStore(' + ${store.stoId} + ')'">ê°€ê²Œ ì‚­ì œ</button>
	<a th:if="${session.UserId == 'admin'}" th:href="@{/load/store/update(id=${store.stoId})}" class="btn btn-info"
		id="updateButton">ê°€ê²Œ ìˆ˜ì •</a>
	<script>
		function deleteStore(stoId) {
			// ì‚­ì œ í™•ì¸ ëŒ€í™” ìƒì
			const isConfirmed = confirm("ì •ë§ë¡œ ì´ ê°€ê²Œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")

			if (isConfirmed) {
				fetch(`/load/store/delete/${stoId}`, {
					method: 'DELETE'
				})
					.then(response => {
						if (response.ok) {
							alert("ê°€ê²Œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
							window.location.href = 'http://localhost:8080/load/place'; // í˜ì´ì§€ ë¦¬ë‹¤ì´ë ‰íŠ¸
						} else {
							alert("ê°€ê²Œ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
						}
					});
			} else {
				alert("ê°€ê²Œ ì‚­ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.");
			}
		}

		function openModal(element) {
			const imgUrl = element.getAttribute('data-img-url');
			const stoName = element.getAttribute('data-sto-name');
			const revText = element.getAttribute('data-rev-text');
			const revRating = element.getAttribute('data-rev-rating');
			const createdAt = element.getAttribute('data-created-at');

			// ëª¨ë‹¬ì— ì •ë³´ ì„¤ì •
			document.getElementById('modalImage').src = imgUrl; // ì´ë¯¸ì§€ URL ì„¤ì •
			document.getElementById('modalStoName').innerText = stoName; // ìƒí˜¸ëª… ì„¤ì •
			document.getElementById('modalRevText').innerText = revText; // ë¦¬ë·° í…ìŠ¤íŠ¸ ì„¤ì •
			document.getElementById('modalRevRating').innerText = `ë³„ì : ${'â˜…'.repeat(revRating)}${'â˜†'.repeat(5 - revRating)}`; // ë³„ì  ì„¤ì •
			document.getElementById('modalCreatedAt').innerText = createdAt; // ìƒì„± ë‚ ì§œ ì„¤ì •

			$('#imageModal').modal('show'); // Bootstrap ëª¨ë‹¬ ì—´ê¸°
		}

		function closeModal() {
			$('#imageModal').modal('hide'); // Bootstrap ëª¨ë‹¬ ë‹«ê¸°
		}

		document.addEventListener('DOMContentLoaded', function () {
			const stars = document.querySelectorAll('.star');
			const revRatingInput = document.getElementById('revRating');
			stars.forEach(star => {
				star.addEventListener('click', function () {
					const rating = this.getAttribute('data-value');
					revRatingInput.value = rating; // í‰ì  ê°’ì„ ìˆ¨ê²¨ì§„ ì…ë ¥ í•„ë“œì— ì €ì¥
					updateStarDisplay(rating); // ë³„ì  í‘œì‹œ ì—…ë°ì´íŠ¸
				});
			});

			function updateStarDisplay(rating) {
				stars.forEach(star => {
					if (star.getAttribute('data-value') <= rating) {
						star.classList.add('selected'); // ì„ íƒëœ ë³„ì ì— ìŠ¤íƒ€ì¼ ì¶”ê°€
					} else {
						star.classList.remove('selected');
					}
				});
			}

			document.getElementById('reviewForm').addEventListener('submit', function (event) {
				event.preventDefault(); // ê¸°ë³¸ í¼ ì œì¶œ ë°©ì§€

				const formData = new FormData();
				formData.append('revText', document.getElementById('revText').value);
				formData.append('revRating', revRatingInput.value); // í‰ì  ì¶”ê°€

				// íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ë”ë¼ë„ ë¦¬ë·°ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë„ë¡ ìˆ˜ì •
				const revImg = document.getElementById('revImg').files[0];
				if (revImg) {
					formData.append('revImg', revImg); // íŒŒì¼ ì¶”ê°€
				}

				const pathParts = window.location.pathname.split('/'); // ê²½ë¡œë¥¼ '/'ë¡œ ë‚˜ëˆ„ê¸°
				const placeId = pathParts[pathParts.length - 1]; // ë§ˆì§€ë§‰ ë¶€ë¶„ì´ placeId

				// ë¦¬ë·° ì¶”ê°€ API í˜¸ì¶œ
				fetch(`http://localhost:8080/load/place/${placeId}/reviews`, {
					method: 'POST',
					body: formData
				})
					.then(response => {
						if (response.ok) {
							return response.json(); // JSON ì‘ë‹µì„ ë°˜í™˜
						} else if (response.status === 401) {
							alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
							window.location.href = 'http://localhost:8080/member/login'; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
							return Promise.reject(); // ë¦¬ë‹¤ì´ë ‰íŠ¸ í›„ í•¨ìˆ˜ ì¢…ë£Œ
						} else if (response.status === 400) {
							alert('ë¦¬ë·° í…ìŠ¤íŠ¸ê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.'); // ì˜ëª»ëœ ìš”ì²­ ì²˜ë¦¬
							return;
						} else {
							throw new Error('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìƒíƒœ ì½”ë“œ: ' + response.status);
						}
					})
					.then(data => {
						// ì„±ê³µì ìœ¼ë¡œ ë¦¬ë·°ê°€ ì¶”ê°€ë˜ë©´ UI ì—…ë°ì´íŠ¸
						alert('ë¦¬ë·°ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
						document.getElementById('reviewForm').reset(); // í¼ ì´ˆê¸°í™”
						location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
					})
					.catch(error => {
						console.error('Error:', error);
						alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
					});
			});

			const reviewBlocks = document.querySelectorAll('.reviewBlock'); // ëª¨ë“  ë¦¬ë·° ë¸”ë¡ ì„ íƒ
			const loadMoreButton = document.getElementById('loadMoreButton'); // "ë”ë³´ê¸°" ë²„íŠ¼ ì„ íƒ

			let currentIndex = 0; // í˜„ì¬ ë³´ì—¬ì£¼ëŠ” ë¦¬ë·° ì¸ë±ìŠ¤

			// ì´ˆê¸° 5ê°œ ë¦¬ë·°ë§Œ ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜
			function showInitialReviews() {
				const totalReviews = reviewBlocks.length; // ì´ ë¦¬ë·° ìˆ˜
				for (let i = 0; i < totalReviews; i++) {
					if (i < 5) {
						reviewBlocks[i].style.display = 'flex'; // ì²˜ìŒ 5ê°œ ë¦¬ë·° ë³´ì´ê¸°
					} else {
						reviewBlocks[i].style.display = 'none'; // ë‚˜ë¨¸ì§€ ë¦¬ë·° ìˆ¨ê¸°ê¸°
					}
				}
				currentIndex = 5; // í˜„ì¬ ì¸ë±ìŠ¤ ì—…ë°ì´íŠ¸
				loadMoreButton.style.display = currentIndex < totalReviews ? 'block' : 'none'; // "ë”ë³´ê¸°" ë²„íŠ¼ í‘œì‹œ
			}

			// "ë”ë³´ê¸°" ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
			loadMoreButton.addEventListener('click', function () {
				const totalReviews = reviewBlocks.length; // ì´ ë¦¬ë·° ìˆ˜
				for (let i = currentIndex; i < currentIndex + 5 && i < totalReviews; i++) {
					reviewBlocks[i].style.display = 'flex'; // ë‹¤ìŒ 5ê°œ ë¦¬ë·° ë³´ì´ê¸°
				}
				currentIndex += 5; // í˜„ì¬ ì¸ë±ìŠ¤ ì—…ë°ì´íŠ¸
				loadMoreButton.style.display = currentIndex < totalReviews ? 'block' : 'none'; // "ë”ë³´ê¸°" ë²„íŠ¼ í‘œì‹œ
			});

			showInitialReviews(); // ì´ˆê¸° ë¦¬ë·° í‘œì‹œ
		});

		// ë¦¬ë·° ì‚­ì œ ê¸°ëŠ¥
		document.querySelectorAll('.delete-review').forEach(button => {
			button.addEventListener('click', function () {
				const revId = this.getAttribute('data-rev-id'); // ë¦¬ë·° ID ê°€ì ¸ì˜¤ê¸°
				const confirmed = confirm('ì •ë§ë¡œ ì´ ë¦¬ë·°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'); // ì‚­ì œ í™•ì¸
				const pathParts = window.location.pathname.split('/'); // ê²½ë¡œë¥¼ '/'ë¡œ ë‚˜ëˆ„ê¸°
				const placeId = pathParts[pathParts.length - 1]; // ë§ˆì§€ë§‰ ë¶€ë¶„ì´ placeId
				if (confirmed) {
					// ë¦¬ë·° ì‚­ì œ API í˜¸ì¶œ
					fetch(`http://localhost:8080/load/place/${placeId}/reviews/${revId}`, {
						method: 'DELETE'
					})
						.then(response => {
							if (response.ok) {
								alert('ë¦¬ë·°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
								location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
							} else {
								throw new Error('ë¦¬ë·° ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
							}
						})
						.catch(error => {
							console.error('Error:', error);
							alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
						});
				}
			});
		});
		window.onload = function () {
			const pathParts = window.location.pathname.split('/'); // ê²½ë¡œë¥¼ '/'ë¡œ ë‚˜ëˆ„ê¸°
			const placeId = pathParts[pathParts.length - 1]; // ë§ˆì§€ë§‰ ë¶€ë¶„ì´ placeId
			// ë¦¬ë·° ì¶”ê°€ API í˜¸ì¶œ
			fetch(`http://localhost:8080/load/place/${placeId}/reviews`)
				.then(response => response.json())
				.then(data => {
					data.forEach(review => addReviewToUI(review));
				})
				.catch(error => console.error('Error fetching reviews:', error));
		};
		$(document).ready(function () {
			const carouselItems = $('#reviewCarousel .carousel-item');
			const totalItems = carouselItems.length;
			let nextcurrentIndex = 7;
			let prevcurrentIndex = 0;

			// ë‹¤ìŒ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
			$('.carousel-control-next').click(function () {
				if (nextcurrentIndex < totalItems - 1) {
					// í˜„ì¬ ì•„ì´í…œì—ì„œ active í´ë˜ìŠ¤ ì œê±°
					carouselItems.eq(prevcurrentIndex).removeClass('active');
					prevcurrentIndex++;
					// ì¸ë±ìŠ¤ ì¦ê°€
					nextcurrentIndex++;
					// ë‹¤ìŒ ì•„ì´í…œì— active í´ë˜ìŠ¤ ì¶”ê°€
					carouselItems.eq(nextcurrentIndex).addClass('active');
				} else {
					alert("ë‹¤ìŒ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.")
				}
			});

			// ì´ì „ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
			$('.carousel-control-prev').click(function () {
				if (prevcurrentIndex > 0) {
					// í˜„ì¬ ì•„ì´í…œì—ì„œ active í´ë˜ìŠ¤ ì œê±°
					carouselItems.eq(nextcurrentIndex).removeClass('active');
					nextcurrentIndex--;
					// ì¸ë±ìŠ¤ ê°ì†Œ
					prevcurrentIndex--;
					// ì´ì „ ì•„ì´í…œì— active í´ë˜ìŠ¤ ì¶”ê°€
					carouselItems.eq(prevcurrentIndex).addClass('active');
				} else {
					alert("ì´ì „ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.")
				}
			});

			const favoriteButtons = document.querySelectorAll('.favorite-btn');

			favoriteButtons.forEach(button => {
				button.addEventListener('click', function () {
					const userId = this.getAttribute('data-userid');
					const storeId = this.getAttribute('data-storeid');
					addFavorite(userId, storeId);
				});
			});
		});

		function addFavorite(memberId, stoId) {
			console.log('memberId:', memberId); // ë””ë²„ê¹…ìš© ì¶œë ¥
			console.log('stoId:', stoId); // ë””ë²„ê¹…ìš© ì¶œë ¥
			fetch(`/store/favorite/add?memberId=${memberId}&stoId=${stoId}`, { // ì„œë²„ì˜ API ì—”ë“œí¬ì¸íŠ¸
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({memberId: memberId, stoId: stoId})
			})
				.then(response => {
					if (response.ok) {
						alert('ì°œí•˜ê¸°ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤!');
					} else {
						return response.text().then(text => {
							alert(text); // ì„œë²„ì—ì„œ ì „ì†¡í•œ ì˜ˆì™¸ ë©”ì‹œì§€ë¥¼ ì‚¬ìš©ìì—ê²Œ í‘œì‹œ
						});
					}
				})
				.catch(error => {
					console.error('Error:', error);
					alert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
				});
		}
	</script>
</div> <!--//layout::content-->

<!-- <script layout:fragment="script"> -->

</html>